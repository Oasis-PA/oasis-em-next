generator client {
  provider = "prisma-client-js"
}

generator zod {
  provider      = "prisma-zod-generator"
  output        = "../src/lib/zod-schemas"
  relationModel = "false"
}

datasource db {
  provider = "postgresql"
  url      = "postgresql://postgres.yyvjzgxyxgalnnwcjfqh:capenga@aws-1-sa-east-1.pooler.supabase.com:5432/postgres"
}

model Genero {
  id_genero Int       @id @default(autoincrement())
  nome      String    @unique
  sigla     String    @unique
  usuarios  Usuario[]
}

model TipoCabelo {
  id_tipo_cabelo Int       @id @default(autoincrement())
  nome           String    @unique
  descricao      String?
  produtos       Produto[]
  usuarios       Usuario[]
}

model Usuario {
  id_usuario           Int                    @id @default(autoincrement())
  nome                 String
  email                String                 @unique
  telefone             String?
  senha                String
  data_nascimento      DateTime?
  data_cadastro        DateTime               @default(now())
  id_genero            Int
  id_tipo_cabelo       Int?
  sobrenome            String?
  sobre                String?
  url_foto             String?                @db.VarChar
  avaliacoes           Avaliacao[]
  favoritos            Favorito[]
  FavoritoArtigo       FavoritoArtigo[]
  passwordResets       PasswordReset[]
  QuestionarioResposta QuestionarioResposta[]
  genero               Genero                 @relation(fields: [id_genero], references: [id_genero])
  tipo_cabelo          TipoCabelo?            @relation(fields: [id_tipo_cabelo], references: [id_tipo_cabelo])
}

model Categoria {
  id_categoria Int       @id @default(autoincrement())
  nome         String    @unique
  descricao    String?
  produtos     Produto[]
}

model Produto {
  id_produto     Int             @id @default(autoincrement())
  nome           String
  marca          String
  preco          Float           @db.Real
  data_cadastro  DateTime        @default(now())
  id_categoria   Int
  descricao      String?
  id_tag         Int?
  id_tipo_pele   Int?
  id_tipo_cabelo Int?
  url_imagem     String?         @db.VarChar(500)
  url_loja       String?         @db.VarChar(500)
  composicao     String?
  qualidades     String?
  mais_detalhes  String?
  avaliacoes     Avaliacao[]
  favoritos      Favorito[]
  ImagemProduto  ImagemProduto[]
  categoria      Categoria       @relation(fields: [id_categoria], references: [id_categoria])
  tag            Tag?            @relation(fields: [id_tag], references: [id_tag], onDelete: NoAction, onUpdate: NoAction)
  tipo_cabelo    TipoCabelo?     @relation(fields: [id_tipo_cabelo], references: [id_tipo_cabelo], onDelete: NoAction, onUpdate: NoAction)
  TipoPele       TipoPele?       @relation(fields: [id_tipo_pele], references: [id_tipo_pele], onDelete: NoAction, onUpdate: NoAction)
  ProdutoTag     ProdutoTag[]
}

model Avaliacao {
  id_avaliacao   Int      @id @default(autoincrement())
  nota           Int
  comentario     String?
  data_avaliacao DateTime @default(now())
  id_usuario     Int
  id_produto     Int
  produto        Produto  @relation(fields: [id_produto], references: [id_produto])
  usuario        Usuario  @relation(fields: [id_usuario], references: [id_usuario])
}

model Favorito {
  id_favorito     Int      @id @default(autoincrement())
  data_favoritado DateTime @default(now())
  id_usuario      Int
  id_produto      Int
  produto         Produto  @relation(fields: [id_produto], references: [id_produto])
  usuario         Usuario  @relation(fields: [id_usuario], references: [id_usuario])
}

model Tag {
  id_tag             Int                  @id @default(autoincrement())
  nome               String               @unique
  slug               String?              @unique @db.VarChar(100)
  descricao          String?
  tipo               String?              @default("caracteristica") @db.VarChar(50)
  ArtigoTag          ArtigoTag[]
  produtos           Produto[]
  ProdutoTag         ProdutoTag[]
  QuestionarioTagMap QuestionarioTagMap[]

  @@index([slug], map: "idx_tag_slug")
}

model PasswordReset {
  id         Int      @id @default(autoincrement())
  token      String   @unique
  id_usuario Int
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  usuario    Usuario  @relation(fields: [id_usuario], references: [id_usuario], onDelete: Cascade, onUpdate: NoAction)
}

model Artigo {
  id              Int              @id @default(autoincrement())
  titulo          String           @default("NOT NULL")
  slug            String           @unique @default("NOT NULL")
  conteudo        String           @default("NOT NULL")
  criadoEm        DateTime         @default(now())
  atualizadoEm    DateTime         @updatedAt
  dataPublicacao  DateTime?        @db.Timestamptz(6)
  resumo          String?
  imagemHeader    String?
  status          String?          @default("rascunho")
  themeDark       Boolean?         @default(false)
  id_categoria    Int?
  CategoriaArtigo CategoriaArtigo? @relation(fields: [id_categoria], references: [id_categoria], onUpdate: NoAction, map: "fk_artigo_categoria")
  ArtigoTag       ArtigoTag[]
  FavoritoArtigo  FavoritoArtigo[]

  @@index([id_categoria], map: "idx_artigo_categoria")
}

model TipoPele {
  id_tipo_pele Int       @id @default(autoincrement())
  created_at   DateTime  @default(now()) @db.Timestamptz(6)
  nome         String?
  Produto      Produto[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model Empresas {
  id                   Int      @id @default(autoincrement()) @db.SmallInt
  nome_sobrenome       String
  email_corporativo    String   @unique @default("")
  telefone             Decimal  @db.Decimal
  empresa_representada String   @db.VarChar
  total_colaboradores  Int
  cargo                String
  motivo_contato       String
  data_solicitacao     DateTime @db.Timestamptz(6)
  status               String
}

model ImagemProduto {
  id_imagem_produto Int     @id @default(autoincrement())
  id_produto        Int
  url_imagem        String
  ordem             Int?
  Produto           Produto @relation(fields: [id_produto], references: [id_produto], onDelete: Cascade, onUpdate: NoAction, map: "fk_produto_imagem")
}

model ArtigoTag {
  artigoId Int
  tagId    Int
  Artigo   Artigo @relation(fields: [artigoId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  Tag      Tag    @relation(fields: [tagId], references: [id_tag], onDelete: Cascade, onUpdate: NoAction)

  @@id([artigoId, tagId])
  @@index([artigoId])
  @@index([tagId])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model FavoritoArtigo {
  id_favorito_artigo Int      @id @default(autoincrement())
  data_favoritado    DateTime @default(now()) @db.Timestamptz(6)
  id_usuario         Int
  id_artigo          Int
  Artigo             Artigo   @relation(fields: [id_artigo], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_favorito_artigo_artigo")
  Usuario            Usuario  @relation(fields: [id_usuario], references: [id_usuario], onDelete: Cascade, onUpdate: NoAction, map: "fk_favorito_artigo_usuario")

  @@unique([id_usuario, id_artigo], map: "unique_usuario_artigo")
  @@index([id_artigo], map: "idx_favorito_artigo_artigo")
  @@index([data_favoritado], map: "idx_favorito_artigo_data")
  @@index([id_usuario], map: "idx_favorito_artigo_usuario")
}

model influenciadores {
  id                Int       @id @default(autoincrement()) @db.SmallInt
  nome_contato      String    @db.VarChar(255)
  email             String    @unique @default("") @db.VarChar(255)
  telefone          Decimal   @db.Decimal
  estado            String    @db.VarChar(255)
  cidade            String    @db.VarChar(255)
  perfil_principal  String    @db.VarChar(255)
  numero_seguidores String    @db.VarChar(50)
  proposta          String
  data_solicitacao  DateTime? @default(now()) @db.Timestamptz(6)
  status            String?   @default("pendente") @db.VarChar(50)

  @@index([data_solicitacao(sort: Desc)], map: "idx_influenciadores_data")
  @@index([email], map: "idx_influenciadores_email")
  @@index([status], map: "idx_influenciadores_status")
}

model Cortes {
  id               Int       @id @default(autoincrement())
  nome             String
  slug             String    @unique
  descricao        String
  historia         String?
  como_fazer       String?
  rosto_compativel String?
  como_arrumar     String?
  imagem_principal String?   @db.VarChar(500)
  status           String    @default("rascunho")
  criadoEm         DateTime  @default(now()) @db.Timestamptz(6)
  atualizadoEm     DateTime  @db.Timestamptz(6)
  data_publicacao  DateTime? @default(now()) @db.Timestamptz(6)

  @@index([slug], map: "idx_cortes_slug")
  @@index([status], map: "idx_cortes_status")
}

model CategoriaArtigo {
  id_categoria Int       @id @default(autoincrement())
  nome         String    @unique @db.VarChar(50)
  slug         String    @unique @db.VarChar(100)
  descricao    String?
  criadoEm     DateTime? @default(now()) @db.Timestamptz(6)
  Artigo       Artigo[]

  @@index([slug], map: "idx_categoria_artigo_slug")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model OpcaoResposta {
  id_opcao    Int       @id @default(autoincrement())
  id_pergunta Int
  valor       String    @db.VarChar(100)
  texto       String    @db.VarChar(500)
  ordem       Int
  criado_em   DateTime? @default(now()) @db.Timestamp(6)
  Pergunta    Pergunta  @relation(fields: [id_pergunta], references: [id_pergunta], onDelete: Cascade, onUpdate: NoAction, map: "fk_opcao_pergunta")

  @@index([ordem], map: "idx_opcao_ordem")
  @@index([id_pergunta], map: "idx_opcao_pergunta")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model Pergunta {
  id_pergunta     Int             @id @default(autoincrement())
  id_questionario Int
  pergunta        String
  subtitulo       String?         @db.VarChar(255)
  campo_bd        String          @db.VarChar(100)
  imagem_url      String?         @db.VarChar(500)
  ordem           Int
  obrigatoria     Boolean?        @default(true)
  criado_em       DateTime?       @default(now()) @db.Timestamp(6)
  atualizado_em   DateTime?       @default(now()) @db.Timestamp(6)
  OpcaoResposta   OpcaoResposta[]
  Questionario    Questionario    @relation(fields: [id_questionario], references: [id_questionario], onDelete: Cascade, onUpdate: NoAction, map: "fk_pergunta_questionario")

  @@index([ordem], map: "idx_pergunta_ordem")
  @@index([id_questionario], map: "idx_pergunta_questionario")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model Questionario {
  id_questionario      Int                    @id @default(autoincrement())
  slug                 String                 @unique @db.VarChar(100)
  titulo               String                 @db.VarChar(255)
  descricao            String?
  icon                 String?                @default("ðŸ“‹") @db.VarChar(10)
  ativo                Boolean?               @default(true)
  ordem                Int?                   @default(0)
  redirect_url         String?                @db.VarChar(255)
  criado_em            DateTime?              @default(now()) @db.Timestamp(6)
  atualizado_em        DateTime?              @default(now()) @db.Timestamp(6)
  Pergunta             Pergunta[]
  QuestionarioResposta QuestionarioResposta[]

  @@index([ativo], map: "idx_questionario_ativo")
  @@index([slug], map: "idx_questionario_slug")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model QuestionarioResposta {
  id_resposta     Int          @id @default(autoincrement())
  id_usuario      Int
  id_questionario Int
  respostas       Json
  data_resposta   DateTime?    @default(now()) @db.Timestamp(6)
  atualizado_em   DateTime?    @default(now()) @db.Timestamp(6)
  Questionario    Questionario @relation(fields: [id_questionario], references: [id_questionario], onDelete: Cascade, onUpdate: NoAction, map: "fk_resposta_questionario")
  Usuario         Usuario      @relation(fields: [id_usuario], references: [id_usuario], onDelete: Cascade, onUpdate: NoAction, map: "fk_resposta_usuario")

  @@unique([id_usuario, id_questionario], map: "unique_usuario_questionario")
  @@index([data_resposta], map: "idx_resposta_data")
  @@index([id_questionario], map: "idx_resposta_questionario")
  @@index([id_usuario], map: "idx_resposta_usuario")
}

model ProdutoTag {
  id_produto_tag Int       @id @default(autoincrement())
  id_produto     Int
  id_tag         Int
  principal      Boolean?  @default(false)
  ordem          Int?
  criado_em      DateTime? @default(now()) @db.Timestamp(6)
  Produto        Produto   @relation(fields: [id_produto], references: [id_produto], onDelete: Cascade, onUpdate: NoAction, map: "fk_produto_tag_produto")
  Tag            Tag       @relation(fields: [id_tag], references: [id_tag], onDelete: Cascade, onUpdate: NoAction, map: "fk_produto_tag_tag")

  @@unique([id_produto, id_tag], map: "unique_produto_tag")
  @@index([id_produto], map: "idx_produto_tag_produto")
  @@index([id_tag], map: "idx_produto_tag_tag")
}

model QuestionarioTagMap {
  id_map         Int       @id @default(autoincrement())
  campo_bd       String    @db.VarChar(100)
  valor_resposta String    @db.VarChar(100)
  id_tag         Int
  peso           Int?      @default(10)
  criado_em      DateTime? @default(now()) @db.Timestamp(6)
  Tag            Tag       @relation(fields: [id_tag], references: [id_tag], onDelete: Cascade, onUpdate: NoAction, map: "fk_questionario_tag_map")

  @@unique([campo_bd, valor_resposta, id_tag], map: "unique_campo_valor_tag")
  @@index([campo_bd], map: "idx_questionario_tag_campo")
  @@index([valor_resposta], map: "idx_questionario_tag_valor")
}
